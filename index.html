<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>임직원 설문조사</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-indigo-50 text-slate-900">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <!-- 헤더 -->
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-3 bg-clip-text text-transparent bg-gradient-to-r from-sky-600 via-indigo-600 to-emerald-600">
        임직원 설문조사
      </h1>
      <p class="text-base md:text-lg text-slate-600">
        관심 있는 주제를 선택한 뒤, 선택한 주제에 대해서만 설문을 진행합니다.
        선택하지 않은 주제는 시스템에서 모두 <span class="font-semibold text-sky-700">미응답</span>으로 처리됩니다.
      </p>
    </header>

    <!-- 단계 인디케이터 -->
    <div class="flex items-center gap-3 text-sm md:text-base mb-6">
      <div class="flex items-center gap-2">
        <div id="step-indicator-1" class="w-8 h-8 rounded-full flex items-center justify-center text-white bg-sky-600 text-xs font-semibold shadow-sm">
          1
        </div>
        <span class="font-semibold text-slate-800">주제 선택</span>
      </div>
      <div class="h-px flex-1 bg-gradient-to-r from-sky-200 via-slate-200 to-indigo-200"></div>
      <div class="flex items-center gap-2">
        <div id="step-indicator-2" class="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 border border-slate-200 text-xs font-semibold bg-white/70">
          2
        </div>
        <span class="font-semibold text-slate-400">설문 응답</span>
      </div>
    </div>

    <!-- 1단계: 주제 선택 -->
    <section id="step-topics" class="space-y-6">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="text-xl md:text-2xl font-bold mb-1 text-slate-900">관심 있는 주제를 선택해 주세요</h2>
          <p class="text-sm md:text-base text-slate-600">
            중복 선택이 가능합니다. 선택한 주제에 해당하는 항목만 설문에 표시됩니다.
          </p>
        </div>
      </div>

      <!-- 주제 목록 -->
      <div id="topic-list" class="grid gap-4 md:grid-cols-2">
        <!-- JS에서 동적으로 생성 -->
      </div>

      <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 mt-4">
        <button
          id="btn-go-to-survey"
          class="inline-flex items-center justify-center rounded-2xl border border-sky-600 bg-gradient-to-r from-sky-500 to-indigo-500 px-5 py-3 text-sm md:text-base font-semibold text-white shadow-md hover:from-sky-600 hover:to-indigo-600 active:scale-[0.99] transition-transform"
        >
          다음 단계로
        </button>
      </div>
    </section>

    <!-- 2단계: 설문 -->
    <section id="step-survey" class="space-y-6 hidden">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="text-xl md:text-2xl font-bold mb-1 text-slate-900">선택한 주제에 대한 설문</h2>
          <p class="text-sm md:text-base text-slate-600">
            선택하지 않은 주제의 응답은 시스템에서 <span class="font-semibold text-sky-700">미응답 처리</span>됩니다.
          </p>
        </div>
        <button
          id="btn-back"
          type="button"
          class="inline-flex items-center justify-center rounded-xl border border-slate-300 bg-white/70 px-4 py-2 text-sm md:text-base font-medium text-slate-700 hover:bg-slate-100 shadow-sm"
        >
          &larr; 주제 다시 선택
        </button>
      </div>

      <form id="survey-form" class="space-y-6">
        <!-- JS에서 설문 문항 섹션 동적으로 생성 -->

        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 mt-4">
          <button
            type="submit"
            class="inline-flex items-center justify-center rounded-2xl border border-emerald-600 bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-3 text-sm md:text-base font-semibold text-white shadow-md hover:from-emerald-600 hover:to-teal-600 active:scale-[0.99] transition-transform"
          >
            설문 제출
          </button>
        </div>
      </form>
    </section>
  </div>

  <script>
    // ===============================
    // 1. 공통 선택지 정의 (만족도)
    // ===============================
    const satisfactionOptions = [
      "매우 만족",
      "대체로 만족",
      "보통",
      "대체로 불만",
      "매우 불만"
    ];

    // ===============================
    // 2. 설문 데이터 정의
    //  - type: 'single' (단답형/단일선택)
    //          'multi'  (복수선택)
    //          'text'   (주관식)
    //  - hasOther: true 이면 '기타' 서술형 입력란 추가
    //  - number: 질문 번호(1~50)
    // ===============================
    const topics = [
      {
        id: "interior",
        title: "인테리어",
        summary: "시그니쳐타워 인테리어·라운지·사무공간 만족도 조사",
        description:
          "ㅇ 인테리어 업체 선정(2024.9월), 인테리어 설계 후 2025.1.1부터 25.4.30일까지 인테리어 공사 실시",
        questions: [
          {
            number: 1,
            text: "시그니쳐타워 인테리어 전반에 대한 만족도는 어떻습니까? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 2,
            text: "라운지 공간에 대한 만족도는 어떻습니까? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 3,
            text: "사무공간에 대한 만족도는 어떻습니까? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 4,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "office_furniture",
        title: "사무가구",
        summary: "6층 목업가구 및 사무가구 선정 과정 만족도 조사",
        description:
          "ㅇ 코리안리빌딩 6층에 목업가구 배치 및 직원 의견 수렴, 선정된 19명 직원 대상으로 설명회 개최 및 업체 선정(2025.1.10)",
        questions: [
          {
            number: 5,
            text: "사무가구 및 목업가구 품평회 관련 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 6,
            text: "선정된 사무가구 제품에 대한 평가는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 7,
            text: "6층 목업가구 테스트 및 설명회에 대한 평가는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 8,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "anniversary",
        title: "창립기념 행사",
        summary: "창립기념식 행사·출장뷔페·머그컵 기념품 만족도",
        description:
          "ㅇ 2025.3.19일 창립기념일을 맞이하여 출장뷔페 행사를 진행(12층과 6층), 기념품으로 사옥 이미지가 머그컵 배포",
        questions: [
          {
            number: 9,
            text: "창립기념식 행사 및 머그컵 기념품에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 10,
            text: "창립기념식 행사에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 11,
            text: "기념품 머그컵에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 12,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "moving",
        title: "이사",
        summary: "사옥 이사 절차 및 안내에 대한 만족도",
        description:
          "ㅇ 이사관련 안내 공지(2025.4.7일), 4.11일~4.13일 본 이사 실시, 4.26일에 후속 이사를 진행 (4월4일 이사설명회는 재택근무로 취소)",
        questions: [
          {
            number: 13,
            text: "사옥 이사 과정에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 14,
            text: "사옥 이사 과정에서 맡았던 역할은? (단답형, 복수선택)",
            type: "multi",
            options: ["출발담당자", "도착담당자", "총무서무", "역할없음", "기타"],
            hasOther: true
          },
          {
            number: 15,
            text: "향후 이사 시 반영되었으면 하는 의견이 있으신 경우 알려주세요. (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "access_card",
        title: "출입증",
        summary: "출입증 카드와 신청·재발급 프로세스 만족도",
        description:
          "ㅇ 시그니쳐타워 보안관리 시스템 설치 및 출입증 배포 (2025.4.8일부터)\nㅇ 사원증/방문증 신청 시 인사총무팀에 협조전을 발송, 분실에 대한 경각심 제고 및 기록관리를 위해 분실 시 사유서를 첨부.",
        questions: [
          {
            number: 16,
            text: "출입증 카드 제품, 업무프로세스에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 17,
            text: "출입증 카드 제품에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 18,
            text: "출입증 신청 및 재발급 프로세스에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 19,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "affiliation_discount",
        title: "제휴할인",
        summary: "건물 내 제휴할인 및 LG전자 복지몰 만족도",
        description:
          "ㅇ 입주시기에 맞추어 시그니쳐 타워 내 상가 제휴할인 약정\nㅇ 코리안리 LG전자 복지몰 오픈(2025.11.20일부터)",
        questions: [
          {
            number: 20,
            text: "제휴할인 전반에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 21,
            text: "건물 내 제휴 할인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 22,
            text: "이용해본 제휴 서비스는? (단답형, 복수선택)",
            type: "multi",
            options: ["식당", "커피", "스포츠센터", "스케쳐스", "와인"]
          },
          {
            number: 23,
            text: "LG전자 복지몰에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 24,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "volunteering",
        title: "봉사활동",
        summary: "해비타트·우리동네희망나눔 등 봉사활동 만족도",
        description:
          "ㅇ 상반기: 해비타트(3기수), 우리동네희망나눔(4기수), 하천정화(4기수), 해양쓰레기(3기수) 운영\nㅇ 하반기: 우리동네희망나눔(3기수), 하천정화(2기수), 해양쓰레기(2기수), 장항습지(1기수) 운영",
        questions: [
          {
            number: 25,
            text: "참석하신 봉사활동을 선택해 주세요. (단답형)",
            type: "single",
            options: ["해양쓰레기", "우리동네희망나눔", "해비타트", "장항습지", "하천정화"]
          },
          {
            number: 26,
            text: "봉사활동에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 27,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          },
          {
            number: 28,
            text: "향후 추가되었으면 하는 봉사활동이 있으신 경우 자유롭게 써주세요. (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "parking",
        title: "주차",
        summary: "시그니쳐타워 주차 시범·본 운영 만족도",
        description:
          "ㅇ 2025.4.14~6.30 동안 추첨을 통한 무료 시범운영 실시\nㅇ 2025.7.1일부터 추첨으로 6개월 단위 주차장 이용(월 요금 130,220원)\nㅇ 전월 24일까지 취소, 차순위 대기자에게 선택권 부여",
        questions: [
          {
            number: 29,
            text: "시그니쳐타워 주차에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 30,
            text: "시범운영기간에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 31,
            text: "본 운영기간에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 32,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "scent_system",
        title: "방향시스템",
        summary: "라운지 방향(향기)시스템 설치 효과 및 만족도",
        description:
          "ㅇ 인테리어 및 꿉꿉한 카페트 냄새 제거 목적으로 각 라운지에 방향(향기)시스템 설치(2025.8.1일부터)",
        questions: [
          {
            number: 33,
            text: "방향시스템에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 34,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "snack24",
        title: "스낵24",
        summary: "스낵24 서비스·상품구성·포인트 수준 만족도",
        description:
          "ㅇ 기존 부비통장으로 지급되던 부비의 일부를 스낵24 포인트로 전환하여 지급\nㅇ 스낵24 통하여 라운지별 스낵바를 설치하고 운영",
        questions: [
          {
            number: 35,
            text: "스낵24 서비스 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 36,
            text: "상품구성에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 37,
            text: "구매 프로세스에 대한 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 38,
            text: "포인트는 어느 정도 수준이 적절하다고 생각하는지? (단답형)",
            type: "single",
            options: [
              "4.5만원(전액)",
              "4만원",
              "3만원(현행)",
              "2만원(축소)",
              "다시 부비로 전환"
            ]
          },
          {
            number: 39,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "chobok_bingsu",
        title: "초복 컵빙수",
        summary: "초복 컵빙수(팥빙수/망고빙수) 행사 만족도",
        description:
          "ㅇ 초복 수박도시락을 초복 컵빙수(팥빙수/망고빙수) 행사로 전환",
        questions: [
          {
            number: 40,
            text: "초복 컵빙수에 대한 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 41,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "credit_rating_event",
        title: "신용등급 상향행사",
        summary: "S&P 신용등급 상향 관련 라운지 행사 만족도",
        description:
          "ㅇ 당사 S&P 신용등급 상향에 따른 4F 라운지 행사\nㅇ 출장뷔페 통한 디저트 및 음료 제공",
        questions: [
          {
            number: 42,
            text: "신용등급 상향평가 관련 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 43,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "christmas_tree",
        title: "크리스마스 트리",
        summary: "라운지·복도 크리스마스 트리 설치 만족도",
        description:
          "ㅇ 라운지 및 복도에 크리스마스 트리 설치(2025.12.3일부터)",
        questions: [
          {
            number: 44,
            text: "크리스마스 트리 설치 관련 전반적인 만족도는? (단답형)",
            type: "single",
            options: satisfactionOptions
          },
          {
            number: 45,
            text: "만족했던 이유와 불만족한 이유, 개선되었으면 하는 부분은? (주관식)",
            type: "text"
          }
        ]
      },
      {
        id: "etc",
        title: "기타",
        summary: "명절선물·각종 서비스 및 기타 개선 의견",
        description: "기타 업무지원 관련 서비스 및 개선 의견",
        questions: [
          {
            number: 46,
            text: "명절선물(고기/생선)에 개선이 필요하다고 생각하는 부분은? (단답형, 복수선택)",
            type: "multi",
            options: ["단가인상", "복지몰로 전환", "업체변경", "상품구성변경", "현행유지"]
          },
          {
            number: 47,
            text: "46번에서 현행유지 외에 선택하신 경우 세부적으로 알려주세요. (주관식)",
            type: "text"
          },
          {
            number: 48,
            text: "현행유지 중인 서비스 중 개선이 필요하다고 생각하는 서비스는? (단답형, 복수선택)",
            type: "multi",
            options: [
              "링코(사무용품)",
              "A4용지(사무용품)",
              "무료 아이스크림",
              "공기청정기",
              "기타"
            ],
            hasOther: true
          },
          {
            number: 49,
            text: "개선이 필요하다고 생각하는 이유와 방법은? (주관식)",
            type: "text"
          },
          {
            number: 50,
            text: "기타 업무지원파트에 요청하고 싶은 개선사항이 있으시면 적어주세요. (주관식)",
            type: "text"
          }
        ]
      }
    ];

    // 선택된 주제
    let selectedTopicIds = new Set();

    // DOM 요소
    const topicListEl = document.getElementById("topic-list");
    const stepTopicsEl = document.getElementById("step-topics");
    const stepSurveyEl = document.getElementById("step-survey");
    const btnGoToSurvey = document.getElementById("btn-go-to-survey");
    const btnBack = document.getElementById("btn-back");
    const surveyForm = document.getElementById("survey-form");
    const stepIndicator1 = document.getElementById("step-indicator-1");
    const stepIndicator2 = document.getElementById("step-indicator-2");

    // ===============================
    // 3. 주제 카드 렌더링 (요약 사용, 더 컬러풀하게)
    // ===============================
    function renderTopicCards() {
      topicListEl.innerHTML = "";

      topics.forEach((topic) => {
        const card = document.createElement("label");
        card.className =
          "group relative flex cursor-pointer flex-col rounded-2xl border border-sky-100 bg-white/80 p-4 shadow-sm hover:shadow-lg hover:border-sky-300 hover:bg-sky-50/70 transition-all";

        const summaryText = topic.summary || topic.description.split("\n")[0];

        card.innerHTML = `
          <div class="flex items-start gap-3">
            <input
              type="checkbox"
              class="mt-1 h-5 w-5 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
              value="${topic.id}"
            />
            <div class="flex-1">
              <div class="flex items-center justify-between gap-2">
                <h3 class="text-base md:text-lg font-semibold text-slate-900">
                  ${topic.title}
                </h3>
                <span class="text-[11px] md:text-xs px-2 py-0.5 rounded-full border border-slate-200 text-slate-400 bg-slate-50 group-has-[:checked]:bg-sky-100 group-has-[:checked]:text-sky-800 group-has-[:checked]:border-sky-300">
                  주제 선택
                </span>
              </div>
              <p class="mt-1 text-xs md:text-sm text-slate-600 line-clamp-2">
                ${summaryText}
              </p>
            </div>
          </div>
        `;

        topicListEl.appendChild(card);
      });
    }

    // ===============================
    // 4. 질문 HTML 생성 헬퍼 (볼드/가독성 강화 + 컬러)
    // ===============================
    function createQuestionHtml(topic, q) {
      let inputHtml = "";

      if (q.type === "single") {
        const opts = q.options && q.options.length ? q.options : satisfactionOptions;
        inputHtml = `
          <div class="flex flex-wrap items-center gap-3">
            ${opts
              .map(
                (opt) => `
              <label class="inline-flex items-center gap-1.5 text-sm md:text-base text-slate-700">
                <input
                  type="radio"
                  name="answers[${q.number}][choice]"
                  value="${opt}"
                  class="h-4 w-4 text-sky-600 border-slate-300 focus:ring-sky-500"
                />
                <span>${opt}</span>
              </label>
            `
              )
              .join("")}
          </div>
        `;
      } else if (q.type === "multi") {
        inputHtml = `
          <div class="flex flex-wrap items-center gap-3">
            ${q.options
              .map(
                (opt) => `
              <label class="inline-flex items-center gap-1.5 text-sm md:text-base text-slate-700">
                <input
                  type="checkbox"
                  name="answers[${q.number}][choices][]"
                  value="${opt}"
                  class="h-4 w-4 text-indigo-600 border-slate-300 focus:ring-indigo-500"
                />
                <span>${opt}</span>
              </label>
            `
              )
              .join("")}
          </div>
          ${
            q.hasOther
              ? `
          <div class="mt-3">
            <input
              type="text"
              name="answers[${q.number}][other]"
              class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm md:text-base text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/70 focus:border-indigo-500"
              placeholder="기타를 선택하신 경우, 구체적으로 작성해 주세요."
            />
          </div>
          `
              : ""
          }
        `;
      } else if (q.type === "text") {
        inputHtml = `
          <textarea
            name="answers[${q.number}][text]"
            rows="3"
            class="mt-2 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm md:text-base text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:border-emerald-500"
            placeholder="자유롭게 의견을 작성해 주세요."
          ></textarea>
        `;
      }

      return `
        <div class="rounded-2xl bg-white px-4 py-4 md:px-5 md:py-5 border border-sky-100 shadow-sm">
          <div class="flex items-start gap-2 mb-2">
            <span class="mt-0.5 inline-flex items-center justify-center rounded-full bg-sky-100 text-sky-700 text-xs md:text-sm font-semibold px-2 py-0.5">
              Q${q.number}
            </span>
            <p class="text-base md:text-lg font-semibold text-slate-900 leading-snug">
              ${q.text}
            </p>
          </div>
          <div class="mt-2">
            ${inputHtml}
          </div>
        </div>
      `;
    }

    // ===============================
    // 5. 선택한 주제로 설문 폼 구성
    // ===============================
    function renderSurveyForm() {
      // 기존 섹션 삭제
      surveyForm.querySelectorAll(".topic-section").forEach((el) => el.remove());

      const fragment = document.createDocumentFragment();

      const selectedTopics = topics.filter((t) => selectedTopicIds.has(t.id));

      selectedTopics.forEach((topic) => {
        const section = document.createElement("section");
        section.className =
          "topic-section rounded-2xl border-l-4 border-l-sky-400 border border-sky-100 bg-white/90 p-4 md:p-5 shadow-md";

        const descHtml = topic.description.replace(/\n/g, "<br />");

        const questionsHtml = topic.questions
          .map((q) => createQuestionHtml(topic, q))
          .join("");

        section.innerHTML = `
          <div class="flex items-start justify-between gap-3 mb-4">
            <div>
              <h3 class="text-lg md:text-xl font-bold text-slate-900">
                ${topic.title}
              </h3>
              <p class="mt-1 text-sm md:text-base text-slate-600">
                ${descHtml}
              </p>
            </div>
            <span class="text-[11px] md:text-xs px-2 py-1 rounded-full bg-sky-100 text-sky-800 border border-sky-200 font-medium">
              응답 대상
            </span>
          </div>

          <div class="space-y-5">
            ${questionsHtml}
          </div>
        `;

        fragment.appendChild(section);
      });

      // 선택하지 않은 주제에 대한 hidden input (미응답 처리용)
      const unselectedTopics = topics.filter((t) => !selectedTopicIds.has(t.id));
      unselectedTopics.forEach((topic) => {
        const hidden = document.createElement("input");
        hidden.type = "hidden";
        hidden.name = `answers[${topic.id}][_status]`;
        hidden.value = "미응답(주제 미선택)";
        fragment.appendChild(hidden);
      });

      const submitBtnWrapper = surveyForm.lastElementChild;
      surveyForm.insertBefore(fragment, submitBtnWrapper);
    }

    // ===============================
    // 6. 화면 전환 및 인디케이터
    // ===============================
    function goToSurveyStep() {
      const checkboxes = topicListEl.querySelectorAll("input[type='checkbox']");
      selectedTopicIds = new Set(
        Array.from(checkboxes)
          .filter((cb) => cb.checked)
          .map((cb) => cb.value)
      );

      if (selectedTopicIds.size === 0) {
        alert("최소 1개 이상의 주제를 선택해 주세요.");
        return;
      }

      renderSurveyForm();

      stepTopicsEl.classList.add("hidden");
      stepSurveyEl.classList.remove("hidden");

      stepIndicator1.className =
        "w-8 h-8 rounded-full flex items-center justify-center text-slate-500 border border-slate-200 text-xs font-semibold bg-white/80";
      stepIndicator2.className =
        "w-8 h-8 rounded-full flex items-center justify-center text-white bg-indigo-600 text-xs font-semibold shadow-sm";
    }

    function backToTopicStep() {
      stepSurveyEl.classList.add("hidden");
      stepTopicsEl.classList.remove("hidden");

      stepIndicator1.className =
        "w-8 h-8 rounded-full flex items-center justify-center text-white bg-sky-600 text-xs font-semibold shadow-sm";
      stepIndicator2.className =
        "w-8 h-8 rounded-full flex items-center justify-center text-slate-400 border border-slate-200 text-xs font-semibold bg-white/70";
    }

    // ===============================
    // 7. 폼 제출 처리 (데모용)
    // ===============================
    surveyForm.addEventListener("submit", function (e) {
      e.preventDefault();

      // 실제 서비스에서는 여기에서 서버로 전송
      const formData = new FormData(surveyForm);
      const entries = {};
      for (const [key, value] of formData.entries()) {
        if (entries[key]) {
          // 복수선택 처리
          if (!Array.isArray(entries[key])) {
            entries[key] = [entries[key]];
          }
          entries[key].push(value);
        } else {
          entries[key] = value;
        }
      }

      console.log("제출 데이터:", entries);
      alert("설문이 제출되었습니다. 감사합니다!");
    });

    // ===============================
    // 8. 초기 실행
    // ===============================
    document.addEventListener("DOMContentLoaded", () => {
      renderTopicCards();
      btnGoToSurvey.addEventListener("click", goToSurveyStep);
      btnBack.addEventListener("click", backToTopicStep);
    });
  </script>
</body>
</html>
