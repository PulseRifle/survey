<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>2025ë…„ ì—…ë¬´ì§€ì› ì„¤ë¬¸ì¡°ì‚¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-indigo-50 text-slate-900">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <!-- í—¤ë” -->
    <header class="mb-4">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-3 bg-clip-text text-transparent bg-gradient-to-r from-sky-600 via-indigo-600 to-emerald-600">
        2025ë…„ ì—…ë¬´ì§€ì› ì„¤ë¬¸ì¡°ì‚¬
      </h1>
      <p class="text-base md:text-lg text-slate-600 leading-relaxed">
        ì£¼ì œë¥¼ ì„ íƒí•˜ê³  ê´€ë ¨ëœ ì§ˆë¬¸ë§Œ ë‹µë³€í•˜ë©°, ëª¨ë“  ì§ˆë¬¸ì— ì‘ë‹µí•˜ì§€ ì•Šë”ë¼ë„ ì €ì¥ ë° ì œì¶œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br />
        ì†Œì¤‘í•œ ì˜ê²¬ì€ ë°˜ì˜ë˜ì§€ ì•Šë”ë¼ë„ í–¥í›„ ìš´ì˜ì— ì°¸ê³ í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
      </p>
    </header>

    <!-- ê¸°ì¡´ ì‘ë‹µ ID ì•ˆë‚´ -->
    <div id="current-id-banner"
      class="hidden mb-6 rounded-2xl border border-emerald-200 bg-emerald-50/80 px-4 py-3 text-sm md:text-base text-emerald-900 flex items-center gap-2">
      <span class="text-lg">âœ…</span>
      <div>
        <span class="font-semibold">ì´ì „ì— ì €ì¥ëœ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.</span>
        <span class="ml-2">ì‘ë‹µ ID: <span id="current-id-text" class="font-bold"></span></span>
      </div>
    </div>

    <!-- ì„¤ë¬¸ í”Œë¡œìš° -->
    <div id="survey-flow">
      <!-- ë‹¨ê³„ -->
      <div class="flex items-center gap-3 text-sm md:text-base mb-6">
        <div class="flex items-center gap-2">
          <div id="step-indicator-1"
            class="w-8 h-8 rounded-full flex items-center justify-center text-white bg-sky-600 text-xs font-semibold shadow-sm">1</div>
          <span class="font-semibold text-slate-800">ì£¼ì œ ì„ íƒ</span>
        </div>
        <div class="h-px flex-1 bg-gradient-to-r from-sky-200 via-slate-200 to-indigo-200"></div>
        <div class="flex items-center gap-2">
          <div id="step-indicator-2"
            class="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 border border-slate-200 text-xs font-semibold bg-white/70">2</div>
          <span class="font-semibold text-slate-400">ì„¤ë¬¸ ì‘ë‹µ</span>
        </div>
      </div>

      <!-- 1ë‹¨ê³„: ì£¼ì œ ì„ íƒ -->
      <section id="step-topics" class="space-y-6">
        <div class="flex items-center justify-between gap-4">
          <div>
            <h2 class="text-xl md:text-2xl font-bold mb-1 text-slate-900">ê´€ì‹¬ ìˆëŠ” ì£¼ì œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
            <p class="text-sm md:text-base text-slate-600">
              ì¤‘ë³µ ì„ íƒì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì„ íƒí•œ ì£¼ì œì— í•´ë‹¹í•˜ëŠ” í•­ëª©ë§Œ ì„¤ë¬¸ì— í‘œì‹œë©ë‹ˆë‹¤.
            </p>
          </div>
          <button id="btn-select-all-topics" type="button"
            class="inline-flex items-center rounded-xl border border-sky-500 bg-white/80 px-3 py-1.5 text-xs md:text-sm font-semibold text-sky-700 hover:bg-sky-50 shadow-sm">
            ëª¨ë‘ ì„ íƒ
          </button>
        </div>

        <div id="topic-list" class="grid gap-4 md:grid-cols-2"></div>

        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 mt-4">
          <button id="btn-go-to-survey"
            class="inline-flex items-center justify-center rounded-2xl border border-sky-600 bg-gradient-to-r from-sky-500 to-indigo-500 px-5 py-3 text-sm md:text-base font-semibold text-white shadow-md hover:from-sky-600 hover:to-indigo-600 active:scale-[0.99] transition-transform">
            ë‹¤ìŒ ë‹¨ê³„ë¡œ
          </button>
        </div>
      </section>

      <!-- 2ë‹¨ê³„: ì„¤ë¬¸ -->
      <section id="step-survey" class="space-y-6 hidden">
        <div class="flex items-start justify-end">
          <button id="btn-back" type="button"
            class="inline-flex items-center justify-center rounded-xl border border-slate-300 bg-white/70 px-4 py-2 text-sm md:text-base font-medium text-slate-700 hover:bg-slate-100 shadow-sm">
            &larr; ì£¼ì œ ë‹¤ì‹œ ì„ íƒ
          </button>
        </div>

        <form id="survey-form" class="space-y-6">
          <!-- ë™ì  ìƒì„± ì„¹ì…˜ -->

          <div id="submit-actions" class="flex justify-end gap-3 pt-4 border-t border-slate-200 mt-4">
            <button id="btn-temp-save" type="button"
              class="inline-flex items-center justify-center rounded-2xl border border-slate-300 bg-white/90 px-5 py-3 text-sm md:text-base font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
              ì„ì‹œ ì €ì¥
            </button>
            <button id="btn-final-submit" type="button"
              class="inline-flex items-center justify-center rounded-2xl border border-emerald-600 bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-3 text-sm md:text-base font-semibold text-white shadow-md hover:from-emerald-600 hover:to-teal-600 active:scale-[0.99] transition-transform">
              ì„¤ë¬¸ ì œì¶œ
            </button>
          </div>
        </form>
      </section>
    </div>

    <!-- ì œì¶œ ì™„ë£Œ í™”ë©´ -->
    <section id="completion-screen" class="hidden mt-10 flex flex-col items-center justify-center text-center">
      <div class="max-w-xl w-full rounded-3xl border border-emerald-200 bg-emerald-50/90 px-6 py-10 shadow-md">
        <div class="text-4xl mb-3">ğŸ‰</div>
        <h2 class="text-2xl md:text-3xl font-bold text-emerald-800 mb-3">
          ì„¤ë¬¸ ì œì¶œì„ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤
        </h2>
        <p class="text-sm md:text-base text-emerald-900 mb-2">
          ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤. ì˜ ì°¸ê³ í•˜ì—¬ í–¥í›„ ì—…ë¬´ì§€ì›ì— ë°˜ì˜í•˜ê² ìŠµë‹ˆë‹¤.
        </p>
        <p class="text-xs md:text-sm text-emerald-900/80">
          ì‘ë‹µ ID: <span id="completion-id-text" class="font-semibold"></span>
        </p>
      </div>
    </section>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyPBS1Wdy0bemgVbP9LRP4Jk6ljOWPaLH1EmjQzexKcOsf1KXyg59TLMYAYUkSOpEJ3/exec";

    let clientIp = "";
    let previousId = null;
    let previousAnswers = null;
    let finalLocked = false;

    const topicListEl = document.getElementById("topic-list");
    const stepTopicsEl = document.getElementById("step-topics");
    const stepSurveyEl = document.getElementById("step-survey");
    const btnGoToSurvey = document.getElementById("btn-go-to-survey");
    const btnBack = document.getElementById("btn-back");
    const surveyForm = document.getElementById("survey-form");
    const submitActionsEl = document.getElementById("submit-actions");

    const stepIndicator1 = document.getElementById("step-indicator-1");
    const stepIndicator2 = document.getElementById("step-indicator-2");

    const currentIdBanner = document.getElementById("current-id-banner");
    const currentIdText = document.getElementById("current-id-text");
    const surveyFlowEl = document.getElementById("survey-flow");
    const completionScreenEl = document.getElementById("completion-screen");
    const completionIdText = document.getElementById("completion-id-text");

    const btnSelectAllTopics = document.getElementById("btn-select-all-topics");
    const btnTempSave = document.getElementById("btn-temp-save");
    const btnFinalSubmit = document.getElementById("btn-final-submit");

    let selectedTopicIds = new Set();

    const satisfactionOptions = ["ë§¤ìš° ë§Œì¡±", "ëŒ€ì²´ë¡œ ë§Œì¡±", "ë³´í†µ", "ëŒ€ì²´ë¡œ ë¶ˆë§Œ", "ë§¤ìš° ë¶ˆë§Œ"];

    /* âœ… ì „ì²´ Q1ë¶€í„° ì¬ë„˜ë²„ë§(í•˜ë“œì½”ë”©) */
    const topics = [
      {
        id: "interior_combo",
        emoji: "ğŸ›‹ï¸",
        title: "ì¸í…Œë¦¬ì–´ ë° ì‚¬ë¬´ê°€êµ¬ ë“±",
        summary: "ë¼ìš´ì§€/ì‚¬ë¬´ê³µê°„, ì‚¬ë¬´ê°€êµ¬, ë°©í–¥ì‹œìŠ¤í…œ, íŠ¸ë¦¬ ì„¤ì¹˜ ë§Œì¡±ë„",
        descriptionLines: [
          "ã…‡ (ì¸í…Œë¦¬ì–´) 2024ë…„ 9ì›”~12ì›” ì„¤ê³„ í›„, 2025ë…„ 1ì›”~4ì›” ì¸í…Œë¦¬ì–´ ê³µì‚¬ ì‹¤ì‹œ",
          "ã…‡ (ì‚¬ë¬´ê°€êµ¬) ìƒ˜í”Œ ë°°ì¹˜í•˜ì—¬ ì˜ê²¬ ìˆ˜ë ´, ì„¤ëª…íšŒ ì‹¤ì‹œ ë° ì—…ì²´ ì„ ì •",
          "ã…‡ (ë°©í–¥ì‹œìŠ¤í…œ) ì¹´í« ëƒ„ìƒˆ ë“± ì™„í™” ëª©ì ìœ¼ë¡œ ë¼ìš´ì§€ì— í–¥ê¸° ë””í“¨ì ¸ ì„¤ì¹˜(2025.8.1~)",
          "ã…‡ (í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬) ë¼ìš´ì§€/ë³µë„ íŠ¸ë¦¬ ì„¤ì¹˜(2025.12.3~)"
        ],
        questions: [
          { number: 1, type: "single", text: "ë¼ìš´ì§€ ê³µê°„ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ” ì–´ë–»ìŠµë‹ˆê¹Œ? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 2, type: "single", text: "ì‚¬ë¬´ê³µê°„ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ” ì–´ë–»ìŠµë‹ˆê¹Œ? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 3, type: "single", text: "ì‚¬ë¬´ê°€êµ¬ ì„ ì • ê³¼ì •ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 4, type: "single", text: "ì‚¬ë¬´ê°€êµ¬ ì œí’ˆì— ëŒ€í•œ í‰ê°€ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 5, type: "single", text: "ë°©í–¥ì‹œìŠ¤í…œì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 6, type: "single", text: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬ ì„¤ì¹˜ ê´€ë ¨ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 7, type: "text",   text: "ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "event",
        emoji: "ğŸª",
        title: "í–‰ì‚¬",
        summary: "ì°½ë¦½ê¸°ë…/ì´ˆë³µ/ì‹ ìš©ë“±ê¸‰ ìƒí–¥ ê´€ë ¨ í–‰ì‚¬ ë§Œì¡±ë„",
        descriptionLines: [
          "ã…‡ ì°½ë¦½ê¸°ë…ì¼ ì¶œì¥ë·”í˜ í–‰ì‚¬ ì‹¤ì‹œ(12ì¸µê³¼ 6ì¸µ), ê¸°ë…í’ˆìœ¼ë¡œ ì‚¬ì˜¥ ì´ë¯¸ì§€ ë¨¸ê·¸ì»µ ë°°í¬",
          "ã…‡ ì´ˆë³µ ìˆ˜ë°•ë„ì‹œë½ì„ ì´ˆë³µ ì»µë¹™ìˆ˜(íŒ¥ë¹™ìˆ˜/ë§ê³ ë¹™ìˆ˜) í–‰ì‚¬ë¡œ ì „í™˜",
          "ã…‡ ë‹¹ì‚¬ S&P ì‹ ìš©ë“±ê¸‰ ìƒí–¥ì— ë”°ë¥¸ 4F ë¼ìš´ì§€ ì¶œì¥ë·”í˜ í–‰ì‚¬"
        ],
        questions: [
          { number: 8,  type: "single", text: "ì°½ë¦½ê¸°ë…ì‹ í–‰ì‚¬ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 9,  type: "single", text: "ê¸°ë…í’ˆ ë¨¸ê·¸ì»µì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 10, type: "single", text: "ì´ˆë³µ ì»µë¹™ìˆ˜ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 11, type: "single", text: "ì‹ ìš©ë“±ê¸‰ ìƒí–¥í‰ê°€ í–‰ì‚¬ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 12, type: "text",   text: "ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "affiliation_discount",
        emoji: "ğŸ·ï¸",
        title: "ì œíœ´í• ì¸",
        summary: "ì œíœ´í• ì¸/ë³µì§€ëª° ì´ìš© ê²½í—˜ ë° ê°œì„  ì˜ê²¬",
        descriptionLines: [
          "ã…‡ ì‹œê·¸ë‹ˆì³íƒ€ì›Œ ë° ì£¼ë³€ ìƒê°€ ì œíœ´í• ì¸",
          "ã…‡ ì½”ë¦¬ì•ˆë¦¬ LGì „ì ë³µì§€ëª° ì˜¤í”ˆ(2025.11.20ì¼ë¶€í„°)"
        ],
        questions: [
          { number: 13, type: "single", text: "ê±´ë¬¼ ë° ì£¼ë³€ìƒê°€ ì œíœ´í• ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 14, type: "multi",  text: "ì´ìš©í•´ë³¸ ì œíœ´ ì„œë¹„ìŠ¤ëŠ”? (ë³µìˆ˜ì„ íƒ)", options: ["ì‹ë‹¹", "ì»¤í”¼", "ìŠ¤í¬ì¸ ì„¼í„°", "ìŠ¤ì¼€ì³ìŠ¤", "ì™€ì¸"] },
          { number: 15, type: "single", text: "LGì „ì ë³µì§€ëª°ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 16, type: "text",   text: "ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },
          { number: 17, type: "text",   text: "í–¥í›„ ì¶”ê°€ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì œíœ´í• ì¸ì´ ìˆìœ¼ì‹  ê²½ìš° ììœ ë¡­ê²Œ ì¨ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "volunteering",
        emoji: "ğŸ¤",
        title: "ë´‰ì‚¬í™œë™",
        summary: "ë´‰ì‚¬í™œë™ ì°¸ì—¬ ë° ë§Œì¡±ë„/ê°œì„  ì˜ê²¬",
        descriptionLines: [
          "ã…‡ ìƒë°˜ê¸°: í•´ë¹„íƒ€íŠ¸(3ê¸°ìˆ˜), ìš°ë¦¬ë™ë„¤í¬ë§ë‚˜ëˆ”(4ê¸°ìˆ˜), í•˜ì²œì •í™”(4ê¸°ìˆ˜), í•´ì–‘ì“°ë ˆê¸°(3ê¸°ìˆ˜) ìš´ì˜",
          "ã…‡ í•˜ë°˜ê¸°: ìš°ë¦¬ë™ë„¤í¬ë§ë‚˜ëˆ”(3ê¸°ìˆ˜), í•˜ì²œì •í™”(2ê¸°ìˆ˜), í•´ì–‘ì“°ë ˆê¸°(2ê¸°ìˆ˜), ì¥í•­ìŠµì§€(1ê¸°ìˆ˜) ìš´ì˜"
        ],
        questions: [
          { number: 18, type: "single", text: "ì°¸ì„í•˜ì‹  ë´‰ì‚¬í™œë™ì„ ì„ íƒí•´ ì£¼ì„¸ìš”. (ë‹¨ë‹µí˜•)", options: ["í•´ì–‘ì“°ë ˆê¸°", "ìš°ë¦¬ë™ë„¤í¬ë§ë‚˜ëˆ”", "í•´ë¹„íƒ€íŠ¸", "ì¥í•­ìŠµì§€", "í•˜ì²œì •í™”"] },
          { number: 19, type: "single", text: "ë´‰ì‚¬í™œë™ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 20, type: "text",   text: "ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },
          { number: 21, type: "text",   text: "í–¥í›„ ì¶”ê°€ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ë´‰ì‚¬í™œë™ì´ ìˆìœ¼ì‹  ê²½ìš° ììœ ë¡­ê²Œ ì¨ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "snack24",
        emoji: "ğŸª",
        title: "ìŠ¤ë‚µ24",
        summary: "ìŠ¤ë‚µ24 ìš´ì˜/êµ¬ë§¤/í¬ì¸íŠ¸ ê´€ë ¨ ë§Œì¡±ë„",
        descriptionLines: [
          "ã…‡ ìŠ¤ë‚µ24 í†µí•˜ì—¬ ë¼ìš´ì§€ë³„ ìŠ¤ë‚µë°”ë¥¼ ì„¤ì¹˜í•˜ê³  ìš´ì˜",
          "ã…‡ ë¶€ë¹„ì˜ ì¼ë¶€ë¥¼ ìŠ¤ë‚µ24 í¬ì¸íŠ¸ë¡œ ì „í™˜ ì§€ê¸‰"
        ],
        questions: [
          { number: 22, type: "single", text: "ìŠ¤ë‚µ24 ì„œë¹„ìŠ¤ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 23, type: "single", text: "ìƒí’ˆêµ¬ì„±ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 24, type: "single", text: "êµ¬ë§¤ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 25, type: "single", text: "í¬ì¸íŠ¸ëŠ” ì–´ëŠ ì •ë„ ìˆ˜ì¤€ì´ ì ì ˆí•˜ë‹¤ê³  ìƒê°í•˜ëŠ”ì§€? (ë‹¨ë‹µí˜•)", options: ["4.5ë§Œì›(ì „ì•¡)", "4ë§Œì›", "3ë§Œì›(í˜„í–‰)", "2ë§Œì›(ì¶•ì†Œ)", "ë‹¤ì‹œ ë¶€ë¹„ë¡œ ì „í™˜"] },
          { number: 26, type: "text",   text: "ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "etc",
        emoji: "ğŸ“",
        title: "ê¸°íƒ€",
        summary: "ì´ì‚¬/ì¶œì…ì¦/ì„œë¹„ìŠ¤ ê°œì„  ë° ê¸°íƒ€ ì˜ê²¬",
        descriptionLines: [
          "ã…‡ (ì´ì‚¬) ì•ˆë‚´ ê³µì§€(2025.4.7ì¼), ì´ì‚¬ ì‹¤ì‹œ(4.11ì¼~4.13ì¼ ë³¸ ì´ì‚¬, 4.26ì¼ í›„ì† ì´ì‚¬)",
          "ã…‡ (ì¶œì…ì¦) ë¶„ì‹¤ì— ëŒ€í•œ ê²½ê°ì‹¬ ì œê³  ë° ê´€ë¦¬ ì² ì € ìœ„í•´ ì‹ ê·œ/ì¬ë°œê¸‰ì‹œ í˜‘ì¡°ì „ ë°œì†¡ ë° ë¶„ì‹¤ì‹œ ì‚¬ìœ ì„œ ì²¨ë¶€"
        ],
        groups: [
          { title: "ì´ì‚¬ ê´€ë ¨", questionNumbers: [27, 28] },
          { title: "ì¶œì…ì¦ ê´€ë ¨", questionNumbers: [29, 30, 31, 32] },
          { title: "ëª…ì ˆì„ ë¬¼ ê´€ë ¨", questionNumbers: [33, 34] },
          { title: "ì„œë¹„ìŠ¤ ê°œì„  ê´€ë ¨", questionNumbers: [35, 36, 37] },
          { title: "ê¸°íƒ€ ì˜ê²¬", questionNumbers: [38] }
        ],
        questions: [
          { number: 27, type: "single", text: "ì‚¬ì˜¥ ì´ì‚¬ ê³¼ì •ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 28, type: "text",   text: "ë‹¤ìŒ ì´ì‚¬ ë•Œ ë°˜ì˜ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },

          { number: 29, type: "single", text: "ì¶œì…ì¹´ë“œ ì œí’ˆì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 30, type: "single", text: "ì•ˆë©´ì¸ì‹ ì‹œìŠ¤í…œì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 31, type: "single", text: "ë°œê¸‰/ì¬ë°œê¸‰ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 32, type: "text",   text: "ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },

          { number: 33, type: "multi",  text: "ëª…ì ˆì„ ë¬¼(ì •ìœ¡/ìƒì„ )ì— ê°œì„ ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„ì€? (ë³µìˆ˜ì„ íƒ)", options: ["ë‹¨ê°€ì¸ìƒ", "ë³µì§€ëª°ë¡œ ì „í™˜", "ì—…ì²´ë³€ê²½", "ìƒí’ˆêµ¬ì„±ë³€ê²½", "í˜„í–‰ìœ ì§€"] },
          { number: 34, type: "text",   text: "ìœ„ì—ì„œ í˜„í–‰ìœ ì§€ ì™¸ì˜ ë‹µë³€ì„ ì„ íƒí•˜ì‹  ê²½ìš° ì´ìœ ë¥¼ ì ì–´ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" },

          { number: 35, type: "multi",  text: "ë‹¤ìŒ ì‚¬í•­ ì¤‘ ë³€í™”ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” í•­ëª©ì€? (ë³µìˆ˜ì„ íƒ)", options: ["ë§ì½”(ì‚¬ë¬´ìš©í’ˆ)", "A4ìš©ì§€(ì‚¬ë¬´ìš©í’ˆ)", "ë¬´ë£Œ ì•„ì´ìŠ¤í¬ë¦¼", "ê¸°íƒ€"], hasOther: true },
          { number: 36, type: "single", text: "ë§ì½” ëŒ€ì‹  ë¼ìš´ì§€ì— ì‚¬ë¬´ìš©í’ˆ ë§¤ëŒ€ ì„¤ì¹˜(ë¬´ë£Œ)ì— ëŒ€í•œ ì˜ê²¬ì€?", options: ["ì°¬ì„±", "ë°˜ëŒ€", "ê¸°íƒ€"], hasOther: true },
          { number: 37, type: "text",   text: "ë³€í™”ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ì´ìœ ì™€ ë°©ë²•ì€? (ì£¼ê´€ì‹)" },

          { number: 38, type: "text",   text: "ì—…ë¬´ì§€ì›íŒŒíŠ¸ì— ë‚¨ê¸°ê³  ì‹¶ì€ ì˜ê²¬ ìˆìœ¼ì‹  ê²½ìš° ì ì–´ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" }
        ]
      }
    ];

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function renderDescriptionHtml(lines) {
      const arr = Array.isArray(lines) ? lines : String(lines || "").split("\n");
      const cleaned = arr.map(s => String(s || "").trim()).filter(Boolean);
      return `
        <div class="space-y-1.5">
          ${cleaned.map(line => {
            if (line.startsWith("ã…‡")) {
              const text = line.replace(/^ã…‡\s*/, "");
              return `
                <div class="flex gap-2">
                  <span class="shrink-0 w-4 text-slate-500 font-semibold">ã…‡</span>
                  <span class="flex-1 text-slate-600 break-words">${escapeHtml(text)}</span>
                </div>
              `;
            }
            return `<div class="text-slate-600 break-words">${escapeHtml(line)}</div>`;
          }).join("")}
        </div>
      `;
    }

    async function fetchClientIp() {
      try {
        const res = await fetch("https://api.ipify.org?format=json");
        const data = await res.json();
        clientIp = data.ip;
      } catch (e) {
        console.warn("IP ì¡°íšŒ ì‹¤íŒ¨:", e);
        clientIp = "";
      }
    }

    async function loadResponseByIp() {
      if (!clientIp) return;
      try {
        const url = `${SCRIPT_URL}?action=get&ip=${encodeURIComponent(clientIp)}`;
        const res = await fetch(url);
        const text = await res.text();
        let data;
        try { data = JSON.parse(text); } catch { return; }
        if (data.status !== "ok") return;

        if (data.exists && data.id) {
          previousId = data.id;
          currentIdText.textContent = previousId;
          completionIdText.textContent = previousId;
          currentIdBanner.classList.remove("hidden");
        }

        if (data.finalSubmitted === true) {
          finalLocked = true;
          submitActionsEl.classList.add("hidden");
          showCompletionScreen();
          return;
        }

        if (data.answers && typeof data.answers === "object") {
          previousAnswers = data.answers;
        }
      } catch (e) {
        console.warn("ê¸°ì¡´ ì‘ë‹µ ì¡°íšŒ ì‹¤íŒ¨:", e);
      }
    }

    function showCompletionScreen() {
      surveyFlowEl.classList.add("hidden");
      completionScreenEl.classList.remove("hidden");
      if (previousId) completionIdText.textContent = previousId;
    }

    /* âœ… ì¦‰ì‹œ ë™ì‘(ë Œë”/ë„¤íŠ¸ì›Œí¬ íƒ€ì´ë° ë¬´ê´€) */
    function getTopicCheckboxes_() {
      return Array.from(document.querySelectorAll("#topic-list input[type='checkbox']"));
    }
    function updateSelectAllButtonLabel_() {
      const cbs = getTopicCheckboxes_();
      const allChecked = cbs.length > 0 && cbs.every(cb => cb.checked);
      btnSelectAllTopics.textContent = allChecked ? "ëª¨ë‘ ì·¨ì†Œ" : "ëª¨ë‘ ì„ íƒ";
    }
    function toggleSelectAllTopics_() {
      const cbs = getTopicCheckboxes_();
      if (!cbs.length) return;
      const allChecked = cbs.every(cb => cb.checked);
      cbs.forEach(cb => cb.checked = !allChecked);
      updateSelectAllButtonLabel_();
    }

    function renderTopicCards() {
      topicListEl.innerHTML = "";
      topics.forEach(topic => {
        const card = document.createElement("label");
        card.className =
          "group relative flex cursor-pointer flex-col rounded-2xl border border-sky-100 bg-white/80 p-4 shadow-sm hover:shadow-lg hover:border-sky-300 hover:bg-sky-50/70 transition-all";

        card.innerHTML = `
          <div class="flex items-start gap-3">
            <input type="checkbox"
              class="mt-1 h-5 w-5 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
              value="${escapeHtml(topic.id)}" />
            <div class="flex-1">
              <div class="flex items-center justify-between gap-2">
                <h3 class="text-base md:text-lg font-semibold text-slate-900">
                  ${escapeHtml(topic.emoji || "ğŸ“Œ")} ${escapeHtml(topic.title)}
                </h3>
                <span class="text-[11px] md:text-xs px-2 py-0.5 rounded-full border border-slate-200 text-slate-400 bg-slate-50">
                  ì£¼ì œ ì„ íƒ
                </span>
              </div>

              <!-- âœ… ìš”ì•½ ë‹¤ì‹œ í‘œì‹œ -->
              <p class="mt-1 text-xs md:text-sm text-slate-600 leading-snug">
                ${escapeHtml(topic.summary || "")}
              </p>
            </div>
          </div>
        `;
        topicListEl.appendChild(card);
      });

      // ê°œë³„ ì²´í¬ ë³€ê²½ ì‹œ ë¼ë²¨ ì¦‰ì‹œ ê°±ì‹ 
      getTopicCheckboxes_().forEach(cb => cb.addEventListener("change", updateSelectAllButtonLabel_));
      // ë Œë” ì§í›„ ë¼ë²¨ ì„¸íŒ…
      updateSelectAllButtonLabel_();
    }

    function createQuestionHtml(q) {
      let inputHtml = "";

      if (q.type === "single") {
        const hasOtherInput = !!q.hasOther;
        inputHtml = `
          <div class="flex flex-wrap items-start gap-x-4 gap-y-2">
            ${(q.options || []).map(opt => `
              <label class="inline-flex items-start gap-2 text-sm md:text-base text-slate-700 leading-snug">
                <input type="radio"
                  name="answers[${q.number}][choice]"
                  value="${escapeHtml(opt)}"
                  class="mt-1 h-4 w-4 text-sky-600 border-slate-300 focus:ring-sky-500" />
                <span class="break-words">${escapeHtml(opt)}</span>
              </label>
            `).join("")}
          </div>
          ${hasOtherInput ? `
            <div class="mt-3">
              <input type="text"
                name="answers[${q.number}][other]"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm md:text-base text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/70 focus:border-indigo-500"
                placeholder="ê¸°íƒ€ë¥¼ ì„ íƒí•˜ì‹  ê²½ìš°, êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”." />
            </div>
          ` : ""}
        `;
      } else if (q.type === "multi") {
        const hasOtherInput = !!q.hasOther;
        inputHtml = `
          <div class="flex flex-wrap items-start gap-x-4 gap-y-2">
            ${(q.options || []).map(opt => `
              <label class="inline-flex items-start gap-2 text-sm md:text-base text-slate-700 leading-snug">
                <input type="checkbox"
                  name="answers[${q.number}][choices][]"
                  value="${escapeHtml(opt)}"
                  class="mt-1 h-4 w-4 text-indigo-600 border-slate-300 focus:ring-indigo-500" />
                <span class="break-words">${escapeHtml(opt)}</span>
              </label>
            `).join("")}
          </div>
          ${hasOtherInput ? `
            <div class="mt-3">
              <input type="text"
                name="answers[${q.number}][other]"
                class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm md:text-base text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500/70 focus:border-indigo-500"
                placeholder="ê¸°íƒ€ë¥¼ ì„ íƒí•˜ì‹  ê²½ìš°, êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”." />
            </div>
          ` : ""}
        `;
      } else {
        inputHtml = `
          <textarea name="answers[${q.number}][text]" rows="3"
            class="w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm md:text-base text-slate-800 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/70 focus:border-emerald-500"
            placeholder="ììœ ë¡­ê²Œ ì˜ê²¬ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."></textarea>
        `;
      }

      return `
        <div class="rounded-2xl bg-white px-4 py-4 md:px-5 md:py-5 border border-sky-100 shadow-sm">
          <div class="grid grid-cols-[auto,1fr] gap-x-3 gap-y-2 items-start">
            <span class="mt-0.5 inline-flex items-center justify-center rounded-full bg-sky-100 text-sky-700 text-xs md:text-sm font-semibold px-2 py-0.5">
              Q${q.number}
            </span>
            <p class="text-base md:text-lg font-semibold text-slate-900 leading-snug break-words">
              ${escapeHtml(q.text)}
            </p>
            <div class="col-start-2">
              ${inputHtml}
            </div>
          </div>
        </div>
      `;
    }

    function renderTopicSection(topic) {
      if (topic.id !== "etc") {
        return `
          <section class="topic-section rounded-2xl border border-sky-100 bg-white/90 p-4 md:p-5 shadow-md">
            <div class="mb-4">
              <h3 class="text-lg md:text-xl font-bold text-slate-900">
                ${escapeHtml(topic.emoji || "ğŸ“Œ")} ${escapeHtml(topic.title)}
              </h3>
              <div class="mt-2 text-sm md:text-base">
                ${renderDescriptionHtml(topic.descriptionLines || [])}
              </div>
            </div>
            <div class="space-y-5">
              ${(topic.questions || []).map(q => createQuestionHtml(q)).join("")}
            </div>
          </section>
        `;
      }

      const qMap = new Map((topic.questions || []).map(q => [q.number, q]));
      const groups = topic.groups || [];

      return `
        <section class="topic-section rounded-2xl border border-sky-100 bg-white/90 p-4 md:p-5 shadow-md">
          <div class="mb-4">
            <h3 class="text-lg md:text-xl font-bold text-slate-900">
              ${escapeHtml(topic.emoji || "ğŸ“Œ")} ${escapeHtml(topic.title)}
            </h3>
            <div class="mt-2 text-sm md:text-base">
              ${renderDescriptionHtml(topic.descriptionLines || [])}
            </div>
          </div>

          <div class="space-y-6">
            ${groups.map((g, idx) => `
              <div class="rounded-2xl border border-slate-200 bg-white/80 p-4 md:p-5 shadow-sm">
                <div class="flex items-center justify-between mb-3">
                  <div class="font-bold text-slate-900 text-base md:text-lg">
                    ${escapeHtml(g.title)}
                  </div>
                  <div class="text-xs text-slate-500">
                    ${escapeHtml(g.questionNumbers.map(n => "Q" + n).join(", "))}
                  </div>
                </div>
                <div class="space-y-5">
                  ${g.questionNumbers.map(n => qMap.get(n)).filter(Boolean).map(q => createQuestionHtml(q)).join("")}
                </div>
              </div>
              ${idx < groups.length - 1 ? `<div class="h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent"></div>` : ``}
            `).join("")}
          </div>
        </section>
      `;
    }

    function renderSurveyForm() {
      surveyForm.querySelectorAll(".topic-section").forEach(el => el.remove());

      const selectedTopics = topics.filter(t => selectedTopicIds.has(t.id));
      const html = selectedTopics.map(t => renderTopicSection(t)).join("");

      const wrapper = document.createElement("div");
      wrapper.innerHTML = html;

      const submitBtnWrapper = surveyForm.lastElementChild;
      surveyForm.insertBefore(wrapper, submitBtnWrapper);
    }

    function applyPreviousAnswers_() {
      if (!previousAnswers) return;

      for (let i = 1; i <= 50; i++) {
        const key = "Q" + i;
        const val = (previousAnswers[key] != null) ? String(previousAnswers[key]) : "";
        if (!val) continue;

        const radios = surveyForm.querySelectorAll(`input[type="radio"][name="answers[${i}][choice]"]`);
        if (radios && radios.length) {
          const isOther = val.startsWith("ê¸°íƒ€:");
          if (isOther) {
            radios.forEach(r => { if (r.value === "ê¸°íƒ€") r.checked = true; });
            const otherInput = surveyForm.querySelector(`input[name="answers[${i}][other]"]`);
            if (otherInput) otherInput.value = val.replace(/^ê¸°íƒ€:\s*/, "");
          } else {
            radios.forEach(r => { if (r.value === val) r.checked = true; });
          }
          continue;
        }

        const checks = surveyForm.querySelectorAll(`input[type="checkbox"][name="answers[${i}][choices][]"]`);
        if (checks && checks.length) {
          const parts = val.split(",").map(s => s.trim()).filter(Boolean);
          checks.forEach(c => { if (parts.includes(c.value)) c.checked = true; });
          const otherPart = parts.find(p => p.startsWith("ê¸°íƒ€:"));
          if (otherPart) {
            const otherInput = surveyForm.querySelector(`input[name="answers[${i}][other]"]`);
            if (otherInput) otherInput.value = otherPart.replace(/^ê¸°íƒ€:\s*/, "");
          }
          continue;
        }

        const ta = surveyForm.querySelector(`textarea[name="answers[${i}][text]"]`);
        if (ta) ta.value = val;
      }
    }

    function collectAnswersByQuestion() {
      const result = {};
      topics.forEach(topic => {
        (topic.questions || []).forEach(q => {
          const key = "Q" + q.number;

          if (q.type === "single") {
            const input = surveyForm.querySelector(`input[name="answers[${q.number}][choice]"]:checked`);
            let v = input ? input.value : "";
            const other = surveyForm.querySelector(`input[name="answers[${q.number}][other]"]`);
            if (other && other.value.trim() && v === "ê¸°íƒ€") v = "ê¸°íƒ€: " + other.value.trim();
            result[key] = v;

          } else if (q.type === "multi") {
            const checks = surveyForm.querySelectorAll(`input[name="answers[${q.number}][choices][]"]:checked`);
            const values = Array.from(checks).map(c => c.value);
            const other = surveyForm.querySelector(`input[name="answers[${q.number}][other]"]`);
            if (other && other.value.trim()) values.push("ê¸°íƒ€: " + other.value.trim());
            result[key] = values.join(", ");

          } else {
            const ta = surveyForm.querySelector(`textarea[name="answers[${q.number}][text]"]`);
            result[key] = ta ? ta.value.trim() : "";
          }
        });
      });
      return result;
    }

    function goToSurveyStep() {
      if (finalLocked) { showCompletionScreen(); return; }

      const checkboxes = topicListEl.querySelectorAll("input[type='checkbox']");
      selectedTopicIds = new Set(Array.from(checkboxes).filter(cb => cb.checked).map(cb => cb.value));

      if (selectedTopicIds.size === 0) {
        alert("ìµœì†Œ 1ê°œ ì´ìƒì˜ ì£¼ì œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
        return;
      }

      renderSurveyForm();
      applyPreviousAnswers_();

      stepTopicsEl.classList.add("hidden");
      stepSurveyEl.classList.remove("hidden");

      stepIndicator1.className = "w-8 h-8 rounded-full flex items-center justify-center text-slate-500 border border-slate-200 text-xs font-semibold bg-white/80";
      stepIndicator2.className = "w-8 h-8 rounded-full flex items-center justify-center text-white bg-indigo-600 text-xs font-semibold shadow-sm";
    }

    function backToTopicStep() {
      stepSurveyEl.classList.add("hidden");
      stepTopicsEl.classList.remove("hidden");

      stepIndicator1.className = "w-8 h-8 rounded-full flex items-center justify-center text-white bg-sky-600 text-xs font-semibold shadow-sm";
      stepIndicator2.className = "w-8 h-8 rounded-full flex items-center justify-center text-slate-400 border border-slate-200 text-xs font-semibold bg-white/70";
    }

    async function saveSurvey(mode) {
      if (finalLocked) return;

      const answers = collectAnswersByQuestion();

      const payload = { IP: clientIp || "", mode };
      for (let i = 1; i <= 50; i++) payload["Q" + i] = "";
      Object.assign(payload, answers);

      try {
        const params = new URLSearchParams();
        params.append("payload", JSON.stringify(payload));

        const res = await fetch(SCRIPT_URL, { method: "POST", body: params });
        const text = await res.text();

        let data;
        try { data = JSON.parse(text); }
        catch {
          alert("ì„œë²„ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì›¹ì•± ë°°í¬/ê¶Œí•œ/URL í™•ì¸ í•„ìš”)");
          return;
        }

        if (data.status !== "ok") {
          alert("ì„œë²„ ì˜¤ë¥˜: " + (data.message || "unknown"));
          return;
        }

        previousId = data.id;
        currentIdText.textContent = previousId;
        currentIdBanner.classList.remove("hidden");
        completionIdText.textContent = previousId;

        if (mode === "TEMP") {
          alert("ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
          previousAnswers = payload;
        } else {
          alert("ì„¤ë¬¸ ì œì¶œì„ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤.");
          finalLocked = true;
          submitActionsEl.classList.add("hidden");
          showCompletionScreen();
        }
      } catch (error) {
        console.error("fetch ì‹¤íŒ¨:", error);
        alert("ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
      }
    }

    document.addEventListener("DOMContentLoaded", async () => {
      // âœ… â€œëª¨ë‘ ì„ íƒâ€ ë²„íŠ¼ì€ ë Œë”/ë„¤íŠ¸ì›Œí¬ì™€ ë¬´ê´€í•˜ê²Œ ì¦‰ì‹œ í´ë¦­ ê°€ëŠ¥
      btnSelectAllTopics.addEventListener("click", toggleSelectAllTopics_);

      // âœ… UI ì¦‰ì‹œ ë Œë”
      renderTopicCards();

      // âœ… ë„¤íŠ¸ì›Œí¬ëŠ” UIì™€ ë…ë¦½ì ìœ¼ë¡œ(ëŠ¦ì–´ë„ ë²„íŠ¼ ë™ì‘ì— ì˜í–¥ ì—†ìŒ)
      fetchClientIp().then(loadResponseByIp).catch(() => {});

      btnGoToSurvey.addEventListener("click", goToSurveyStep);
      btnBack.addEventListener("click", backToTopicStep);
      btnTempSave.addEventListener("click", () => saveSurvey("TEMP"));
      btnFinalSubmit.addEventListener("click", () => saveSurvey("FINAL"));
    });
  </script>
</body>
</html>
