<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>2025ë…„ ì—…ë¬´ì§€ì› ì„¤ë¬¸ì¡°ì‚¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-sky-50 to-indigo-50 text-slate-900">
  <div class="max-w-5xl mx-auto px-4 py-8">
    <header class="mb-4">
      <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight mb-3 bg-clip-text text-transparent bg-gradient-to-r from-sky-600 via-indigo-600 to-emerald-600">
        2025ë…„ ì—…ë¬´ì§€ì› ì„¤ë¬¸ì¡°ì‚¬
      </h1>
      <p class="text-base md:text-lg text-slate-600 leading-relaxed">
        ì£¼ì œë¥¼ ì„ íƒí•˜ê³  ê´€ë ¨ëœ ì§ˆë¬¸ë§Œ ë‹µë³€í•˜ë©°, ëª¨ë“  ì§ˆë¬¸ì— ì‘ë‹µí•˜ì§€ ì•Šë”ë¼ë„ ì €ì¥ ë° ì œì¶œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br />
        ì†Œì¤‘í•œ ì˜ê²¬ì€ ë°˜ì˜ë˜ì§€ ì•Šë”ë¼ë„ í–¥í›„ ìš´ì˜ì— ì°¸ê³ í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
      </p>
    </header>

    <div id="current-id-banner"
      class="hidden mb-6 rounded-2xl border border-emerald-200 bg-emerald-50/80 px-4 py-3 text-sm md:text-base text-emerald-900 flex items-center gap-2">
      <span class="text-lg">âœ…</span>
      <div>
        <span class="font-semibold">ì´ì „ì— ì €ì¥ëœ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤.</span>
        <span class="ml-2">ì‘ë‹µ ID: <span id="current-id-text" class="font-bold"></span></span>
      </div>
    </div>

    <div id="survey-flow">
      <div class="flex items-center gap-3 text-sm md:text-base mb-6">
        <div class="flex items-center gap-2">
          <div id="step-indicator-1"
            class="w-8 h-8 rounded-full flex items-center justify-center text-white bg-sky-600 text-xs font-semibold shadow-sm">1</div>
          <span class="font-semibold text-slate-800">ì£¼ì œ ì„ íƒ</span>
        </div>
        <div class="h-px flex-1 bg-gradient-to-r from-sky-200 via-slate-200 to-indigo-200"></div>
        <div class="flex items-center gap-2">
          <div id="step-indicator-2"
            class="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 border border-slate-200 text-xs font-semibold bg-white/70">2</div>
          <span class="font-semibold text-slate-400">ì„¤ë¬¸ ì‘ë‹µ</span>
        </div>
      </div>

      <section id="step-topics" class="space-y-6">
        <div class="flex items-center justify-between gap-4">
          <div>
            <h2 class="text-xl md:text-2xl font-bold mb-1 text-slate-900">ê´€ì‹¬ ìˆëŠ” ì£¼ì œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
            <p class="text-sm md:text-base text-slate-600">ì¤‘ë³µ ì„ íƒì´ ê°€ëŠ¥í•˜ë©°, ì„ íƒí•œ ì£¼ì œ í•­ëª©ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</p>
          </div>
          <button id="btn-select-all-topics" type="button"
            class="inline-flex items-center rounded-xl border border-sky-500 bg-white/80 px-3 py-1.5 text-xs md:text-sm font-semibold text-sky-700 hover:bg-sky-50 shadow-sm">
            ëª¨ë‘ ì„ íƒ
          </button>
        </div>

        <div id="topic-list" class="grid gap-4 md:grid-cols-2"></div>

        <div class="flex justify-end gap-3 pt-4 border-t border-slate-200 mt-4">
          <button id="btn-go-to-survey"
            class="inline-flex items-center justify-center rounded-2xl border border-sky-600 bg-gradient-to-r from-sky-500 to-indigo-500 px-5 py-3 text-sm md:text-base font-semibold text-white shadow-md hover:from-sky-600 hover:to-indigo-600 transition-transform active:scale-[0.99]">
            ë‹¤ìŒ ë‹¨ê³„ë¡œ
          </button>
        </div>
      </section>

      <section id="step-survey" class="space-y-6 hidden">
        <div class="flex items-start justify-end">
          <button id="btn-back" type="button"
            class="inline-flex items-center justify-center rounded-xl border border-slate-300 bg-white/70 px-4 py-2 text-sm md:text-base font-medium text-slate-700 hover:bg-slate-100 shadow-sm">
            &larr; ì£¼ì œ ë‹¤ì‹œ ì„ íƒ
          </button>
        </div>

        <form id="survey-form" class="space-y-6">
          <div id="submit-actions" class="flex justify-end gap-3 pt-4 border-t border-slate-200 mt-4">
            <button id="btn-temp-save" type="button"
              class="inline-flex items-center justify-center rounded-2xl border border-slate-300 bg-white/90 px-5 py-3 text-sm md:text-base font-semibold text-slate-700 shadow-sm hover:bg-slate-50">
              ì„ì‹œ ì €ì¥
            </button>
            <button id="btn-final-submit" type="button"
              class="inline-flex items-center justify-center rounded-2xl border border-emerald-600 bg-gradient-to-r from-emerald-500 to-teal-500 px-6 py-3 text-sm md:text-base font-semibold text-white shadow-md hover:from-emerald-600 hover:to-teal-600 transition-transform active:scale-[0.99]">
              ì„¤ë¬¸ ì œì¶œ
            </button>
          </div>
        </form>
      </section>
    </div>

    <section id="completion-screen" class="hidden mt-10 flex flex-col items-center justify-center text-center">
      <div class="max-w-xl w-full rounded-3xl border border-emerald-200 bg-emerald-50/90 px-6 py-10 shadow-md">
        <div class="text-4xl mb-3">ğŸ‰</div>
        <h2 class="text-2xl md:text-3xl font-bold text-emerald-800 mb-3">ì„¤ë¬¸ ì œì¶œì„ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤</h2>
        <p class="text-sm md:text-base text-emerald-900 mb-2">ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤.</p>
        <p class="text-xs md:text-sm text-emerald-900/80">ì‘ë‹µ ID: <span id="completion-id-text" class="font-semibold"></span></p>
        <button onclick="location.reload()" class="mt-6 text-sm text-sky-600 underline">ìƒˆ ì‘ë‹µ ì‘ì„±í•˜ê¸°</button>
      </div>
    </section>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyPBS1Wdy0bemgVbP9LRP4Jk6ljOWPaLH1EmjQzexKcOsf1KXyg59TLMYAYUkSOpEJ3/exec";

    let clientIp = "";
    let previousId = null;
    let previousAnswers = null;
    let finalLocked = false;

    // DOM ìš”ì†Œ ìºì‹±
    const topicListEl = document.getElementById("topic-list");
    const stepTopicsEl = document.getElementById("step-topics");
    const stepSurveyEl = document.getElementById("step-survey");
    const btnGoToSurvey = document.getElementById("btn-go-to-survey");
    const btnBack = document.getElementById("btn-back");
    const surveyForm = document.getElementById("survey-form");
    const submitActionsEl = document.getElementById("submit-actions");
    const currentIdBanner = document.getElementById("current-id-banner");
    const currentIdText = document.getElementById("current-id-text");
    const surveyFlowEl = document.getElementById("survey-flow");
    const completionScreenEl = document.getElementById("completion-screen");
    const completionIdText = document.getElementById("completion-id-text");
    const btnSelectAllTopics = document.getElementById("btn-select-all-topics");
    const btnTempSave = document.getElementById("btn-temp-save");
    const btnFinalSubmit = document.getElementById("btn-final-submit");
    const stepIndicator1 = document.getElementById("step-indicator-1");
    const stepIndicator2 = document.getElementById("step-indicator-2");

    let selectedTopicIds = new Set();
    const satisfactionOptions = ["ë§¤ìš° ë§Œì¡±", "ëŒ€ì²´ë¡œ ë§Œì¡±", "ë³´í†µ", "ëŒ€ì²´ë¡œ ë¶ˆë§Œ", "ë§¤ìš° ë¶ˆë§Œ"];

    // ì£¼ì œ ë°ì´í„°
    const topics = [
      {
        id: "interior_combo",
        emoji: "ğŸ›‹ï¸",
        title: "ì¸í…Œë¦¬ì–´ ë° ì‚¬ë¬´ê°€êµ¬ ë“±",
        summary: "ë¼ìš´ì§€/ì‚¬ë¬´ê³µê°„, ì‚¬ë¬´ê°€êµ¬, ë°©í–¥ì‹œìŠ¤í…œ, íŠ¸ë¦¬ ì„¤ì¹˜ ë§Œì¡±ë„",
        descriptionLines: [
          "ã…‡ (ì¸í…Œë¦¬ì–´) 2024ë…„ 9ì›”~12ì›” ì„¤ê³„ í›„, 2025ë…„ 1ì›”~4ì›” ì¸í…Œë¦¬ì–´ ê³µì‚¬ ì‹¤ì‹œ",
          "ã…‡ (ì‚¬ë¬´ê°€êµ¬) ìƒ˜í”Œ ë°°ì¹˜í•˜ì—¬ ì˜ê²¬ ìˆ˜ë ´, ì„¤ëª…íšŒ ì‹¤ì‹œ ë° ì—…ì²´ ì„ ì •",
          "ã…‡ (ë°©í–¥ì‹œìŠ¤í…œ) ì¹´í« ëƒ„ìƒˆ ë“± ì™„í™” ëª©ì ìœ¼ë¡œ ë¼ìš´ì§€ì— í–¥ê¸° ë””í“¨ì ¸ ì„¤ì¹˜(2025.8.1~)",
          "ã…‡ (í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬) ë¼ìš´ì§€/ë³µë„ íŠ¸ë¦¬ ì„¤ì¹˜(2025.12.3~)"
        ],
        questions: [
          { number: 1, type: "single", text: "ë¼ìš´ì§€ ê³µê°„ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ” ì–´ë–»ìŠµë‹ˆê¹Œ? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 2, type: "single", text: "ì‚¬ë¬´ê³µê°„ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ” ì–´ë–»ìŠµë‹ˆê¹Œ? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 3, type: "single", text: "ì‚¬ë¬´ê°€êµ¬ ì„ ì • ê³¼ì •ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 4, type: "single", text: "ì‚¬ë¬´ê°€êµ¬ ì œí’ˆì— ëŒ€í•œ í‰ê°€ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 5, type: "single", text: "ë°©í–¥ì‹œìŠ¤í…œì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 6, type: "single", text: "í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬ ì„¤ì¹˜ ê´€ë ¨ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 7, type: "text",   text: "ìœ„ ì¸í…Œë¦¬ì–´ ë° ì‚¬ë¬´ê°€êµ¬ ê´€ë ¨ ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "event",
        emoji: "ğŸª",
        title: "í–‰ì‚¬",
        summary: "ì°½ë¦½ê¸°ë…/ì´ˆë³µ/ì‹ ìš©ë“±ê¸‰ ìƒí–¥ ê´€ë ¨ í–‰ì‚¬ ë§Œì¡±ë„",
        descriptionLines: [
          "ã…‡ ì°½ë¦½ê¸°ë…ì¼ ì¶œì¥ë·”í˜ í–‰ì‚¬ ì‹¤ì‹œ(12ì¸µê³¼ 6ì¸µ), ê¸°ë…í’ˆìœ¼ë¡œ ì‚¬ì˜¥ ì´ë¯¸ì§€ ë¨¸ê·¸ì»µ ë°°í¬",
          "ã…‡ ì´ˆë³µ ìˆ˜ë°•ë„ì‹œë½ì„ ì´ˆë³µ ì»µë¹™ìˆ˜(íŒ¥ë¹™ìˆ˜/ë§ê³ ë¹™ìˆ˜) í–‰ì‚¬ë¡œ ì „í™˜",
          "ã…‡ ë‹¹ì‚¬ S&P ì‹ ìš©ë“±ê¸‰ ìƒí–¥ì— ë”°ë¥¸ 4F ë¼ìš´ì§€ ì¶œì¥ë·”í˜ í–‰ì‚¬"
        ],
        questions: [
          { number: 8,  type: "single", text: "ì°½ë¦½ê¸°ë…ì‹ í–‰ì‚¬ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 9,  type: "single", text: "ê¸°ë…í’ˆ ë¨¸ê·¸ì»µì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 10, type: "single", text: "ì´ˆë³µ ì»µë¹™ìˆ˜ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 11, type: "single", text: "ì‹ ìš©ë“±ê¸‰ ìƒí–¥í‰ê°€ í–‰ì‚¬ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 12, type: "text",   text: "ìœ„ í–‰ì‚¬ë“¤ ê´€ë ¨ ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "affiliation_discount",
        emoji: "ğŸ·ï¸",
        title: "ì œíœ´í• ì¸",
        summary: "ì œíœ´í• ì¸/ë³µì§€ëª° ì´ìš© ê²½í—˜ ë° ê°œì„  ì˜ê²¬",
        descriptionLines: [
          "ã…‡ ì‹œê·¸ë‹ˆì³íƒ€ì›Œ ë° ì£¼ë³€ ìƒê°€ ì œíœ´í• ì¸",
          "ã…‡ ì½”ë¦¬ì•ˆë¦¬ LGì „ì ë³µì§€ëª° ì˜¤í”ˆ(2025.11.20ì¼ë¶€í„°)"
        ],
        questions: [
          { number: 13, type: "single", text: "ê±´ë¬¼ ë° ì£¼ë³€ìƒê°€ ì œíœ´í• ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 14, type: "multi",  text: "ì´ìš©í•´ë³¸ ì œíœ´ ì„œë¹„ìŠ¤ëŠ”? (ë³µìˆ˜ì„ íƒ)", options: ["ì‹ë‹¹", "ì»¤í”¼", "ìŠ¤í¬ì¸ ì„¼í„°", "ìŠ¤ì¼€ì³ìŠ¤", "ì™€ì¸"] },
          { number: 15, type: "single", text: "LGì „ì ë³µì§€ëª°ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 16, type: "text",   text: "ìœ„ ì œíœ´í• ì¸ ê´€ë ¨ ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },
          { number: 17, type: "text",   text: "í–¥í›„ ì¶”ê°€ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì œíœ´í• ì¸ì´ ìˆìœ¼ì‹  ê²½ìš° ììœ ë¡­ê²Œ ì¨ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "volunteering",
        emoji: "ğŸ¤",
        title: "ë´‰ì‚¬í™œë™",
        summary: "ë´‰ì‚¬í™œë™ ì°¸ì—¬ ë° ë§Œì¡±ë„/ê°œì„  ì˜ê²¬",
        descriptionLines: [
          "ã…‡ ìƒë°˜ê¸°: í•´ë¹„íƒ€íŠ¸(3ê¸°ìˆ˜), ìš°ë¦¬ë™ë„¤í¬ë§ë‚˜ëˆ”(4ê¸°ìˆ˜), í•˜ì²œì •í™”(4ê¸°ìˆ˜), í•´ì–‘ì“°ë ˆê¸°(3ê¸°ìˆ˜) ìš´ì˜",
          "ã…‡ í•˜ë°˜ê¸°: ìš°ë¦¬ë™ë„¤í¬ë§ë‚˜ëˆ”(3ê¸°ìˆ˜), í•˜ì²œì •í™”(2ê¸°ìˆ˜), í•´ì–‘ì“°ë ˆê¸°(2ê¸°ìˆ˜), ì¥í•­ìŠµì§€(1ê¸°ìˆ˜) ìš´ì˜"
        ],
        questions: [
          { number: 18, type: "single", text: "ì°¸ì„í•˜ì‹  ë´‰ì‚¬í™œë™ì„ ì„ íƒí•´ ì£¼ì„¸ìš”. (ë‹¨ë‹µí˜•)", options: ["í•´ì–‘ì“°ë ˆê¸°", "ìš°ë¦¬ë™ë„¤í¬ë§ë‚˜ëˆ”", "í•´ë¹„íƒ€íŠ¸", "ì¥í•­ìŠµì§€", "í•˜ì²œì •í™”"] },
          { number: 19, type: "single", text: "ë´‰ì‚¬í™œë™ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 20, type: "text",   text: "ìœ„ ë´‰ì‚¬í™œë™ ê´€ë ¨ ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },
          { number: 21, type: "text",   text: "í–¥í›„ ì¶”ê°€ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ë´‰ì‚¬í™œë™ì´ ìˆìœ¼ì‹  ê²½ìš° ììœ ë¡­ê²Œ ì¨ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "snack24",
        emoji: "ğŸª",
        title: "ìŠ¤ë‚µ24",
        summary: "ìŠ¤ë‚µ24 ìš´ì˜/êµ¬ë§¤/í¬ì¸íŠ¸ ê´€ë ¨ ë§Œì¡±ë„",
        descriptionLines: [
          "ã…‡ ìŠ¤ë‚µ24 í†µí•˜ì—¬ ë¼ìš´ì§€ë³„ ìŠ¤ë‚µë°”ë¥¼ ì„¤ì¹˜í•˜ê³  ìš´ì˜",
          "ã…‡ ë¶€ë¹„ì˜ ì¼ë¶€ë¥¼ ìŠ¤ë‚µ24 í¬ì¸íŠ¸ë¡œ ì „í™˜ ì§€ê¸‰"
        ],
        questions: [
          { number: 22, type: "single", text: "ìŠ¤ë‚µ24 ì„œë¹„ìŠ¤ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 23, type: "single", text: "ìƒí’ˆêµ¬ì„±ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 24, type: "single", text: "êµ¬ë§¤ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 25, type: "single", text: "í¬ì¸íŠ¸ëŠ” ì–´ëŠ ì •ë„ ìˆ˜ì¤€ì´ ì ì ˆí•˜ë‹¤ê³  ìƒê°í•˜ëŠ”ì§€? (ë‹¨ë‹µí˜•)", options: ["4.5ë§Œì›(ì „ì•¡)", "4ë§Œì›", "3ë§Œì›(í˜„í–‰)", "2ë§Œì›(ì¶•ì†Œ)", "ë‹¤ì‹œ ë¶€ë¹„ë¡œ ì „í™˜"] },
          { number: 26, type: "text",   text: "ìœ„ ìŠ¤ë‚µ24 ê´€ë ¨ ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" }
        ]
      },
      {
        id: "etc",
        emoji: "ğŸ“",
        title: "ê¸°íƒ€",
        summary: "ì´ì‚¬/ì¶œì…ì¦/ì„œë¹„ìŠ¤ ê°œì„  ë° ê¸°íƒ€ ì˜ê²¬",
        descriptionLines: [
          "ã…‡ (ì´ì‚¬) ì•ˆë‚´ ê³µì§€(2025.4.7ì¼), ì´ì‚¬ ì‹¤ì‹œ(4.11ì¼~4.13ì¼ ë³¸ ì´ì‚¬, 4.26ì¼ í›„ì† ì´ì‚¬)",
          "ã…‡ (ì¶œì…ì¦) ë¶„ì‹¤ì— ëŒ€í•œ ê²½ê°ì‹¬ ì œê³  ë° ê´€ë¦¬ ì² ì € ìœ„í•´ ì‹ ê·œ/ì¬ë°œê¸‰ì‹œ í˜‘ì¡°ì „ ë°œì†¡ ë° ë¶„ì‹¤ì‹œ ì‚¬ìœ ì„œ ì²¨ë¶€"
        ],
        groups: [
          { title: "ì´ì‚¬ ê´€ë ¨", questionNumbers: [27, 28] },
          { title: "ì¶œì…ì¦ ê´€ë ¨", questionNumbers: [29, 30, 31, 32] },
          { title: "ëª…ì ˆì„ ë¬¼ ê´€ë ¨", questionNumbers: [33, 34] },
          { title: "ì„œë¹„ìŠ¤ ê°œì„  ê´€ë ¨", questionNumbers: [35, 36, 37] },
          { title: "ê¸°íƒ€ ì˜ê²¬", questionNumbers: [38] }
        ],
        questions: [
          { number: 27, type: "single", text: "ì‚¬ì˜¥ ì´ì‚¬ ê³¼ì •ì— ëŒ€í•œ ì „ë°˜ì ì¸ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 28, type: "text",   text: "ë‹¤ìŒ ì´ì‚¬ ë•Œ ë°˜ì˜ë˜ì—ˆìœ¼ë©´ í•˜ëŠ” ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },
          { number: 29, type: "single", text: "ì¶œì…ì¹´ë“œ ì œí’ˆì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 30, type: "single", text: "ì•ˆë©´ì¸ì‹ ì‹œìŠ¤í…œì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 31, type: "single", text: "ë°œê¸‰/ì¬ë°œê¸‰ í”„ë¡œì„¸ìŠ¤ì— ëŒ€í•œ ë§Œì¡±ë„ëŠ”? (ë‹¨ë‹µí˜•)", options: satisfactionOptions },
          { number: 32, type: "text",   text: "ìœ„ ì¶œì…ì¦ ê´€ë ¨ ë§Œì¡±/ë¶ˆë§Œì¡±í•œ ì´ìœ ì™€ ì´ì— ëŒ€í•œ ì˜ê²¬ì€? (ì£¼ê´€ì‹)" },
          { number: 33, type: "multi",  text: "ëª…ì ˆì„ ë¬¼(ì •ìœ¡/ìƒì„ )ì— ê°œì„ ì´ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„ì€? (ë³µìˆ˜ì„ íƒ)", options: ["ë‹¨ê°€ì¸ìƒ", "ë³µì§€ëª°ë¡œ ì „í™˜", "ì—…ì²´ë³€ê²½", "ìƒí’ˆêµ¬ì„±ë³€ê²½", "í˜„í–‰ìœ ì§€"] },
          { number: 34, type: "text",   text: "ìœ„ì—ì„œ í˜„í–‰ìœ ì§€ ì™¸ì˜ ë‹µë³€ì„ ì„ íƒí•˜ì‹  ê²½ìš° ì´ìœ ë¥¼ ì ì–´ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" },
          { number: 35, type: "multi",  text: "ë‹¤ìŒ ì‚¬í•­ ì¤‘ ë³€í™”ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” í•­ëª©ì€? (ë³µìˆ˜ì„ íƒ)", options: ["ë§ì½”(ì‚¬ë¬´ìš©í’ˆ)", "A4ìš©ì§€(ì‚¬ë¬´ìš©í’ˆ)", "ë¬´ë£Œ ì•„ì´ìŠ¤í¬ë¦¼", "ê¸°íƒ€"], hasOther: true },
          { number: 36, type: "single", text: "ë§ì½” ëŒ€ì‹  ë¼ìš´ì§€ì— ì‚¬ë¬´ìš©í’ˆ ë§¤ëŒ€ ì„¤ì¹˜(ë¬´ë£Œ)ì— ëŒ€í•œ ì˜ê²¬ì€?", options: ["ì°¬ì„±", "ë°˜ëŒ€", "ê¸°íƒ€"], hasOther: true },
          { number: 37, type: "text",   text: "ë³€í™”ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ì´ìœ ì™€ ë°©ë²•ì€? (ì£¼ê´€ì‹)" },
          { number: 38, type: "text",   text: "ì—…ë¬´ì§€ì›íŒŒíŠ¸ì— ë‚¨ê¸°ê³  ì‹¶ì€ ì˜ê²¬ ìˆìœ¼ì‹  ê²½ìš° ì ì–´ì£¼ì„¸ìš”. (ì£¼ê´€ì‹)" }
        ]
      }
    ];

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"}[m]));
    }

    function renderDescriptionHtml(lines) {
      const arr = Array.isArray(lines) ? lines : String(lines || "").split("\n");
      return `<div class="space-y-1.5">${arr.map(line => {
        const text = line.trim();
        if (!text) return "";
        if (text.startsWith("ã…‡")) {
          return `<div class="flex gap-2"><span class="shrink-0 w-4 text-slate-500 font-semibold">ã…‡</span><span class="flex-1 text-slate-600 break-words">${escapeHtml(text.substring(1).trim())}</span></div>`;
        }
        return `<div class="text-slate-600 break-words">${escapeHtml(text)}</div>`;
      }).join("")}</div>`;
    }

    // IP ë° ì´ì „ ë°ì´í„° ë¡œë“œ
    async function initData() {
      try {
        const ipRes = await fetch("https://api.ipify.org?format=json");
        const ipData = await ipRes.json();
        clientIp = ipData.ip;

        const res = await fetch(`${SCRIPT_URL}?action=get&ip=${encodeURIComponent(clientIp)}`);
        const data = await res.json();

        if (data.status === "ok" && data.exists) {
          previousId = data.id;
          currentIdText.textContent = previousId;
          completionIdText.textContent = previousId;
          currentIdBanner.classList.remove("hidden");

          // â˜… PC í™˜ê²½ì„ ê³ ë ¤í•˜ì—¬, ë‹¨ìˆœíˆ IPê°€ ê°™ë‹¤ê³  ë§‰ì§€ ì•Šê³  
          // ì •ë§ë¡œ ë³¸ì¸ì´ ì œì¶œ ì™„ë£Œí–ˆëŠ”ì§€ ëª…í™•í•œ ë°ì´í„°ê°€ ìˆì„ ë•Œë§Œ ì ê¸ˆ ì²˜ë¦¬
          if (data.finalSubmitted === true) {
            // ì›í•˜ì‹ ë‹¤ë©´ ì´ ë¶€ë¶„ì„ ì£¼ì„ ì²˜ë¦¬í•˜ì—¬ ì¤‘ë³µ ì œì¶œì„ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            // finalLocked = true;
            // showCompletionScreen();
          }

          if (data.answers) previousAnswers = data.answers;
        }
      } catch (e) {
        console.warn("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", e);
      }
    }

    function showCompletionScreen() {
      surveyFlowEl.classList.add("hidden");
      completionScreenEl.classList.remove("hidden");
    }

    // 1ë‹¨ê³„: ì£¼ì œ ë Œë”ë§
    function renderTopicCards() {
      topicListEl.innerHTML = topics.map(topic => `
        <label class="group relative flex cursor-pointer flex-col rounded-2xl border border-sky-100 bg-white/80 p-4 shadow-sm hover:shadow-lg hover:border-sky-300 hover:bg-sky-50/70 transition-all">
          <div class="flex items-start gap-3">
            <input type="checkbox" class="mt-1 h-5 w-5 rounded border-slate-300 text-sky-600 focus:ring-sky-500" value="${escapeHtml(topic.id)}" />
            <div class="flex-1">
              <div class="flex items-center justify-between gap-2">
                <h3 class="text-base md:text-lg font-semibold text-slate-900">${escapeHtml(topic.emoji)} ${escapeHtml(topic.title)}</h3>
                <span class="text-[11px] md:text-xs px-2 py-0.5 rounded-full border border-slate-200 text-slate-400 bg-slate-50">ì£¼ì œ ì„ íƒ</span>
              </div>
              <p class="mt-1 text-xs md:text-sm text-slate-600 leading-snug">${escapeHtml(topic.summary)}</p>
            </div>
          </div>
        </label>
      `).join("");
    }

    // ì§ˆë¬¸ ìƒì„±ê¸°
    function createQuestionHtml(q) {
      let inputHtml = "";
      const qName = `answers[${q.number}]`;

      if (q.type === "single") {
        inputHtml = `<div class="flex flex-wrap items-start gap-x-4 gap-y-2">
          ${q.options.map(opt => `
            <label class="inline-flex items-start gap-2 text-sm md:text-base text-slate-700 leading-snug">
              <input type="radio" name="${qName}[choice]" value="${escapeHtml(opt)}" class="mt-1 h-4 w-4 text-sky-600 border-slate-300" />
              <span>${escapeHtml(opt)}</span>
            </label>
          `).join("")}
        </div>`;
      } else if (q.type === "multi") {
        inputHtml = `<div class="flex flex-wrap items-start gap-x-4 gap-y-2">
          ${q.options.map(opt => `
            <label class="inline-flex items-start gap-2 text-sm md:text-base text-slate-700 leading-snug">
              <input type="checkbox" name="${qName}[choices][]" value="${escapeHtml(opt)}" class="mt-1 h-4 w-4 text-indigo-600 border-slate-300" />
              <span>${escapeHtml(opt)}</span>
            </label>
          `).join("")}
        </div>`;
      } else {
        inputHtml = `<textarea name="${qName}[text]" rows="3" class="w-full rounded-lg border border-slate-200 p-3 text-sm md:text-base focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="ì˜ê²¬ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."></textarea>`;
      }

      if (q.hasOther) {
        inputHtml += `<div class="mt-3"><input type="text" name="${qName}[other]" class="w-full rounded-lg border border-slate-200 p-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500" placeholder="ê¸°íƒ€ ì˜ê²¬ ì‘ì„±" /></div>`;
      }

      return `
        <div class="rounded-2xl bg-white p-4 md:p-5 border border-sky-100 shadow-sm">
          <div class="grid grid-cols-[auto,1fr] gap-x-3 gap-y-2">
            <span class="inline-flex items-center justify-center rounded-full bg-sky-100 text-sky-700 text-xs font-bold px-2 py-0.5">Q${q.number}</span>
            <p class="text-base md:text-lg font-semibold text-slate-900 break-words">${escapeHtml(q.text)}</p>
            <div class="col-start-2">${inputHtml}</div>
          </div>
        </div>
      `;
    }

    function renderSurveyForm() {
      const selectedTopics = topics.filter(t => selectedTopicIds.has(t.id));
      const html = selectedTopics.map(topic => `
        <section class="topic-section rounded-2xl border border-sky-100 bg-white/90 p-4 md:p-5 shadow-md mb-6">
          <h3 class="text-lg md:text-xl font-bold text-slate-900 mb-2">${escapeHtml(topic.emoji)} ${escapeHtml(topic.title)}</h3>
          <div class="mb-4 text-sm">${renderDescriptionHtml(topic.descriptionLines)}</div>
          <div class="space-y-5">${topic.questions.map(q => createQuestionHtml(q)).join("")}</div>
        </section>
      `).join("");
      
      const content = document.createElement("div");
      content.innerHTML = html;
      surveyForm.prepend(content);
    }

    // ë¡œì§ ì œì–´
    btnGoToSurvey.addEventListener("click", () => {
      const checks = topicListEl.querySelectorAll("input[type='checkbox']:checked");
      if (checks.length === 0) return alert("ì£¼ì œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.");
      selectedTopicIds = new Set(Array.from(checks).map(c => c.value));
      
      // ê¸°ì¡´ ë Œë”ë§ ì œê±° í›„ ìƒˆë¡œ ìƒì„±
      surveyForm.querySelectorAll(".topic-section").forEach(el => el.remove());
      renderSurveyForm();
      
      stepTopicsEl.classList.add("hidden");
      stepSurveyEl.classList.remove("hidden");
      stepIndicator1.className = "w-8 h-8 rounded-full flex items-center justify-center text-slate-500 border border-slate-200 bg-white/80";
      stepIndicator2.className = "w-8 h-8 rounded-full flex items-center justify-center text-white bg-indigo-600 shadow-sm";
    });

    btnBack.addEventListener("click", () => {
      stepSurveyEl.classList.add("hidden");
      stepTopicsEl.classList.remove("hidden");
      stepIndicator1.className = "w-8 h-8 rounded-full flex items-center justify-center text-white bg-sky-600 shadow-sm";
      stepIndicator2.className = "w-8 h-8 rounded-full flex items-center justify-center text-slate-400 border border-slate-200 bg-white/70";
    });

    async function saveSurvey(mode) {
      const formData = new FormData(surveyForm);
      const payload = { IP: clientIp, mode };
      
      // ì§ˆë¬¸ ë°ì´í„° ìˆ˜ì§‘ (ê°„ì†Œí™”ëœ ë¡œì§)
      topics.forEach(t => t.questions.forEach(q => {
        const key = "Q" + q.number;
        if (q.type === "single") payload[key] = formData.get(`answers[${q.number}][choice]`) || "";
        else if (q.type === "multi") payload[key] = formData.getAll(`answers[${q.number}][choices][]`).join(", ");
        else payload[key] = formData.get(`answers[${q.number}][text]`) || "";
        
        const other = formData.get(`answers[${q.number}][other]`);
        if (other) payload[key] += (payload[key] ? " / ê¸°íƒ€: " : "ê¸°íƒ€: ") + other;
      }));

      try {
        const params = new URLSearchParams();
        params.append("payload", JSON.stringify(payload));
        const res = await fetch(SCRIPT_URL, { method: "POST", body: params });
        const data = await res.json();

        if (data.status === "ok") {
          if (mode === "FINAL") {
            showCompletionScreen();
          } else {
            alert("ì„ì‹œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ID: " + data.id);
            previousId = data.id;
            currentIdText.textContent = data.id;
            currentIdBanner.classList.remove("hidden");
          }
        }
      } catch (e) {
        alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      }
    }

    btnTempSave.addEventListener("click", () => saveSurvey("TEMP"));
    btnFinalSubmit.addEventListener("click", () => {
      if(confirm("ìµœì¢… ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´í›„ ìˆ˜ì •ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")) saveSurvey("FINAL");
    });

    btnSelectAllTopics.addEventListener("click", () => {
      const cbs = topicListEl.querySelectorAll("input[type='checkbox']");
      const allChecked = Array.from(cbs).every(cb => cb.checked);
      cbs.forEach(cb => cb.checked = !allChecked);
      btnSelectAllTopics.textContent = !allChecked ? "ëª¨ë‘ ì·¨ì†Œ" : "ëª¨ë‘ ì„ íƒ";
    });

    // ì´ˆê¸°í™” ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", () => {
      renderTopicCards();
      initData();
    });
  </script>
</body>
</html>
